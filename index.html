<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Crossy Road +</title>
<style>
  body { margin: 0; overflow: hidden; background: #87ceeb; font-family: sans-serif; }
  canvas { display: block; margin: 0 auto; background: #87ceeb; }
</style>
</head>
<body>

<audio id="bgMusic" loop>
  <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>
<audio id="jumpSound">
  <source src="https://freesound.org/data/previews/66/66717_931655-lq.mp3" type="audio/mpeg">
</audio>
<audio id="hitSound">
  <source src="https://freesound.org/data/previews/156/156103_2730995-lq.mp3" type="audio/mpeg">
</audio>
<audio id="coinSound">
  <source src="https://freesound.org/data/previews/341/341695_6241731-lq.mp3" type="audio/mpeg">
</audio>
<audio id="powerSound">
  <source src="https://freesound.org/data/previews/331/331912_3248244-lq.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');
canvas.width = 500;
canvas.height = 600;
document.body.appendChild(canvas);

const jumpSound = document.getElementById('jumpSound');
const hitSound = document.getElementById('hitSound');
const coinSound = document.getElementById('coinSound');
const powerSound = document.getElementById('powerSound');
const bgMusic = document.getElementById('bgMusic');
bgMusic.volume = 0.3;

const player = { x: 225, y: 550, width: 30, height: 30, color: 'green', targetX: 225, targetY: 550, shield: false, doublePoints: false };
let score = 0;
let speedMultiplier = 1;
let gameOver = false;

// Lane types: 0=road,1=water
const lanes = [
  { y: 50, speed: 2, cars: [], type: 0 },
  { y: 100, speed: 0, logs: [], type: 1 },
  { y: 150, speed: 3, cars: [], type: 0 },
  { y: 200, speed: 0, logs: [], type: 1 },
  { y: 250, speed: 2.5, cars: [], type: 0 },
  { y: 300, speed: 0, logs: [], type: 1 },
  { y: 350, speed: 3.5, cars: [], type: 0 },
  { y: 400, speed: 0, logs: [], type: 1 }
];

const carTypes = [
  { width: 50, height: 30, color: 'red' },
  { width: 70, height: 30, color: 'blue' },
  { width: 40, height: 30, color: 'yellow' }
];
const logTypes = [
  { width: 80, height: 30, color: 'brown' },
  { width: 120, height: 30, color: 'sienna' }
];

let coins = [];
let powerUps = [];

// Smooth player movement
function movePlayer() {
  const speed = 10;
  if(player.x < player.targetX) player.x += speed;
  if(player.x > player.targetX) player.x -= speed;
  if(player.y < player.targetY) player.y += speed;
  if(player.y > player.targetY) player.y -= speed;
}

// Spawn cars, logs, coins, power-ups
function spawnObjects() {
  lanes.forEach(lane => {
    if(lane.type === 0 && Math.random() < 0.02 * speedMultiplier){
      const type = carTypes[Math.floor(Math.random() * carTypes.length)];
      lane.cars.push({ x: -type.width, y: lane.y, width: type.width, height: type.height, color: type.color });
    }
    if(lane.type === 1 && Math.random() < 0.01 * speedMultiplier){
      const type = logTypes[Math.floor(Math.random() * logTypes.length)];
      lane.logs.push({ x: -type.width, y: lane.y, width: type.width, height: type.height, color: type.color });
    }
  });

  if(Math.random() < 0.01){
    coins.push({ x: Math.random()*450, y: 50 + Math.floor(Math.random()*500), width: 20, height: 20, color: 'gold' });
  }

  if(Math.random() < 0.005){
    const type = Math.random() < 0.5 ? 'shield' : 'double';
    powerUps.push({ x: Math.random()*450, y: 50 + Math.floor(Math.random()*500), width: 25, height: 25, type, color: type==='shield'?'cyan':'magenta', duration: 500 });
  }
}

// Move cars and logs
function moveObjects() {
  lanes.forEach(lane => {
    if(lane.type === 0){
      lane.cars.forEach(car => car.x += lane.speed * speedMultiplier);
      lane.cars = lane.cars.filter(car => car.x < canvas.width + 100);
    } else {
      lane.logs.forEach(log => log.x += (lane.speed + 1) * speedMultiplier);
      lane.logs = lane.logs.filter(log => log.x < canvas.width + 150);
    }
  });
}

// Check collisions
function checkCollision() {
  if(gameOver) return;

  for(const lane of lanes){
    if(lane.type === 0){
      for(const car of lane.cars){
        if(player.x < car.x + car.width &&
           player.x + player.width > car.x &&
           player.y < car.y + car.height &&
           player.y + player.height > car.y){
          if(!player.shield){
            hitSound.play();
            gameOver = true;
            setTimeout(resetGame, 500);
          } else {
            player.shield = false;
          }
        }
      }
    } else {
      const inLane = player.y >= lane.y && player.y < lane.y + 30;
      if(inLane){
        let onLog = false;
        for(const log of lane.logs){
          if(player.x < log.x + log.width &&
             player.x + player.width > log.x){
            onLog = true;
            player.targetX += (lane.speed + 1) * speedMultiplier;
          }
        }
        if(!onLog){
          if(!player.shield){
            hitSound.play();
            gameOver = true;
            setTimeout(resetGame, 500);
          } else {
            player.shield = false;
          }
        }
      }
    }
  }

  // Coins
  coins = coins.filter(coin => {
    if(player.x < coin.x + coin.width &&
       player.x + player.width > coin.x &&
       player.y < coin.y + coin.height &&
       player.y + player.height > coin.y){
      coinSound.play();
      score += player.doublePoints ? 10 : 5;
      return false;
    }
    return true;
  });

  // Power-ups
  powerUps = powerUps.filter(p => {
    if(player.x < p.x + p.width &&
       player.x + player.width > p.x &&
       player.y < p.y + p.height &&
       player.y + player.height > p.y){
      powerSound.play();
      if(p.type==='shield') player.shield = true;
      if(p.type==='double') player.doublePoints = true;
      setTimeout(()=>{ if(p.type==='double') player.doublePoints=false; }, p.duration);
      return false;
    }
    return true;
  });
}

// Draw everything
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw lanes
  lanes.forEach(lane => {
    if(lane.type === 0){
      ctx.fillStyle = '#555';
      ctx.fillRect(0, lane.y, canvas.width, 30);
    } else {
      ctx.fillStyle = '#1e90ff';
      ctx.fillRect(0, lane.y, canvas.width, 30);
    }
  });

  // Draw player
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);
  if(player.shield){
    ctx.strokeStyle = 'cyan';
    ctx.lineWidth = 3;
    ctx.strokeRect(player.x-3, player.y-3, player.width+6, player.height+6);
  }

  // Draw cars and logs
  lanes.forEach(lane => {
    lane.cars?.forEach(car => {
      ctx.fillStyle = car.color;
      ctx.fillRect(car.x, car.y, car.width, car.height);
    });
    lane.logs?.forEach(log => {
      ctx.fillStyle = log.color;
      ctx.fillRect(log.x, log.y, log.width, log.height);
    });
  });

  // Draw coins
  coins.forEach(coin => {
    ctx.fillStyle = coin.color;
    ctx.beginPath();
    ctx.arc(coin.x + 10, coin.y + 10, 10, 0, Math.PI*2);
    ctx.fill();
  });

  // Draw power-ups
  powerUps.forEach(p => {
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, p.width, p.height);
  });

  // Draw score
  ctx.fillStyle = 'black';
  ctx.font = '20px Arial';
  ctx.fillText('Score: ' + score, 10, 20);

  // Draw Made by Josh J
  ctx.fillStyle = 'black';
  ctx.font = '16px Arial';
  ctx.fillText('Made by Josh J', canvas.width - 120, canvas.height - 10);
}

// Game loop
function gameLoop(){
  spawnObjects();
  moveObjects();
  movePlayer();
  checkCollision();
  draw();
  requestAnimationFrame(gameLoop);
}

// Reset game
function resetGame(){
  player.x = 225; player.y = 550; player.targetX = 225; player.targetY = 550;
  player.shield = false; player.doublePoints = false;
  score = 0; gameOver = false;
  lanes.forEach(l => { l.cars=[]; l.logs=[]; });
  coins=[]; powerUps=[];
  speedMultiplier = 1;
}

// Controls
document.addEventListener('keydown', e => {
  if(gameOver) return;
  switch(e.key){
    case 'ArrowUp': if(player.targetY > 0){ player.targetY -= 50; score += player.doublePoints ? 2 : 1; jumpSound.play(); } break;
    case 'ArrowDown': if(player.targetY < 550){ player.targetY += 50; jumpSound.play(); } break;
    case 'ArrowLeft': if(player.targetX > 0){ player.targetX -= 50; jumpSound.play(); } break;
    case 'ArrowRight': if(player.targetX < 470){ player.targetX += 50; jumpSound.play(); } break;
  }
});

// Difficulty increase
setInterval(()=>{ speedMultiplier += 0.01; }, 1000);

// Start game
bgMusic.play();
gameLoop();
</script>
</body>
</html>
